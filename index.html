<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Blackjack Pro ‚Äî Hi-Lo Live Analyzer H17</title>
<style>
  :root{
    --bg:#071014; --panel:#0d1a1f; --accent:#00d18a; --muted:#9aa9b0; --danger:#ff6b6b;
    --card:#0b2a2a;
  }
  body{background:var(--bg); color:#ecf6f5; font-family:Inter,system-ui,Segoe UI,Arial; margin:0; padding:18px;}
  header{display:flex;gap:12px;align-items:center}
  h1{margin:.2rem 0;color:var(--accent)}
  .container{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:12px}
  .panel{background:var(--panel);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.6)}
  label{display:block;color:var(--muted);font-size:12px;margin-top:8px}
  input[type=text], input[type=number], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #153236;background:#071f20;color:#e8f7f2}
  button{background:var(--accent);color:#00220f;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;margin-top:8px}
  .smallbtn{padding:6px 8px;font-size:13px}
  .row{display:flex;gap:8px;align-items:center}
  .stat{margin:8px 0;padding:10px;border-radius:10px;background:linear-gradient(180deg,#062b30,#052025);font-size:14px}
  .muted{color:var(--muted);font-size:13px}
  .badge{display:inline-block;padding:6px 8px;border-radius:8px;background:#022523;color:#a8f6df;margin-right:6px;font-weight:600}
  .danger{background:var(--danger);color:#2b0000}
  .hands{display:flex;gap:12px;flex-wrap:wrap}
  .hand{min-width:180px;padding:10px;border-radius:10px;background:#071f22}
  .cards{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .card{background:var(--card);padding:8px 10px;border-radius:8px;min-width:30px;text-align:center;font-weight:700}
  footer{position:fixed;left:18px;bottom:18px;display:flex;align-items:center;gap:10px}
  .countdot{width:14px;height:14px;border-radius:50%;display:inline-block;border:2px solid #0a2f26}
  .green{background:#17d18a;box-shadow:0 0 8px #17d18a66}
  .red{background:#ff6b6b;box-shadow:0 0 8px #ff6b6b66}
  .log{max-height:160px;overflow:auto;padding:8px;background:#051517;border-radius:8px;margin-top:8px;font-size:13px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .mini{font-size:13px;padding:6px 8px}
  .center{display:flex;align-items:center;gap:8px}
  .settings{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .hint{font-size:13px;color:var(--muted)}
</style>
</head>
<body>

<header>
  <div>
    <h1>üÉè Blackjack Pro ‚Äî Hi-Lo Live Analyzer H17</h1>
    <div class="muted">Continuous count ‚Ä¢ Splits, doubles ‚Ä¢ Dealer draws & other players ‚Ä¢ Bankroll & bet spread ‚Ä¢ H17 Basic Strategy</div>
  </div>
</header>

<div class="container">

  <!-- LEFT: Controls -->
  <div class="panel">
    <label>Decks (N#) ‚Äî set number of decks and start a new shoe</label>
    <div class="row">
      <input id="numDecks" type="number" min="1" max="8" value="6"/>
      <button class="smallbtn" onclick="setDecks()">Set N</button>
      <button class="smallbtn" onclick="fullReset()">Reset All</button>
    </div>

    <label>Initial Setup (type then click Analyze)</label>
    <input id="setup" placeholder="Example: N6 D10 M9 P7  ‚Äî N optional if set above" />
    <div class="row">
      <button onclick="processInput()">Analyze / Start Hand</button>
      <button onclick="nextRound()" class="smallbtn">Next Round (keep count)</button>
    </div>
    <div class="muted">Recommended Move: <span id="recommendedMove">-</span> ‚Ä¢ Win %: <span id="winPercent">-</span></div>
    <div class="hint">Use letters: D=dealer upcard, M=your first card, P=player subsequent cards. Use J,Q,K,A or numbers 2-10.</div>

    <hr style="opacity:.08;margin:10px 0">

    <label>Add Player Card</label>
    <div class="row">
      <input id="addCard" placeholder="e.g. P3  OR just 3" />
      <button onclick="addCard()" class="smallbtn">Add</button>
      <button onclick="undoLast()" class="smallbtn">Undo</button>
    </div>

    <label>Other Players' Seen Cards</label>
    <input id="otherPlayers" placeholder="e.g. 10,9,K,A  or P: 5 6 10" />
    <div class="row">
      <button onclick="addOtherPlayers()" class="smallbtn">Add Other Cards</button>
    </div>

    <label>Dealer Hole & Draws</label>
    <input id="dealerDraws" placeholder="Examples: 9 (hole), 7, 5 OR 9,7,5" />
    <div class="row">
      <button onclick="setDealerHole()" class="smallbtn">Set Hole & Draws</button>
      <button onclick="burnCard()" class="smallbtn">Burn Card</button>
    </div>

    <label>Splits / Doubles / Hand Controls</label>
    <div class="controls">
      <button onclick="doSplit()" class="mini">Split</button>
      <button onclick="doDouble()" class="mini">Double</button>
      <button onclick="finishHand()" class="mini">Finish Hand</button>
    </div>

    <label>Bankroll & Betting</label>
    <div class="settings">
      <div>
        <label>Total Bankroll ($)</label>
        <input id="bankroll" type="number" min="0" value="1000"/>
      </div>
      <div>
        <label>Minimum Bet ($)</label>
        <input id="minBet" type="number" min="1" value="10"/>
      </div>
    </div>

    <label>Bet Spread Mapping (CSV)</label>
    <textarea id="spreadMap" rows="2" placeholder="Example: 0:1,1:2,2:4,3:8,4:12">0:1,1:2,2:4,3:8,4:12</textarea>
    <div class="row">
      <button onclick="applySpread()">Apply Spread</button>
      <button onclick="placeSuggestedBet()" class="smallbtn">Place Suggested Bet</button>
    </div>

    <label>Record Result</label>
    <div class="row">
      <button onclick="recordWin()" class="smallbtn">Record Win</button>
      <button onclick="recordLoss()" class="smallbtn danger">Record Loss</button>
      <button onclick="recordPush()" class="smallbtn">Push</button>
    </div>

    <div class="row">
      <button onclick="refreshDisplay()" class="smallbtn">Refresh Display</button>
      <button onclick="saveSettings()" class="smallbtn">Save Settings</button>
      <button onclick="loadSettings()" class="smallbtn">Load Settings</button>
    </div>

    <div style="margin-top:10px" class="log" id="actionLog"></div>
  </div>

  <!-- RIGHT: Output & Hands -->
  <div class="panel">
    <div class="row">
      <div class="badge">Decks: <span id="displayDecks">6</span></div>
      <div class="badge">Rounds: <span id="roundCount">0</span></div>
      <div class="badge">Running: <span id="runningCount">0</span></div>
      <div class="badge">True: <span id="trueCount">0.00</span></div>
      <div class="badge">Remaining Decks: <span id="remDecks">6.00</span></div>
    </div>

    <div style="margin-top:12px" class="hands">
      <div class="hand">
        <div class="muted">Dealer (upcard + hole/draws)</div>
        <div class="cards" id="dealerCards"></div>
        <div class="muted" id="dealerStatus">Dealer hole: -  ‚Ä¢ draws: -</div>
      </div>

      <div id="handContainer" class="hand" style="min-width:260px;">
        <div class="muted">Player Hand(s)</div>
        <div class="cards" id="playerCards"></div>
        <div class="muted" id="playerStatus">Total: 0</div>
      </div>
    </div>
  </div>

</div>

<footer>
  <div class="badge">Bankroll: $<span id="displayBankroll">1000</span></div>
  <div class="badge">Bet: $<span id="currentBet">10</span></div>
</footer>

<script>
// ========== Game State ==========
let numDecks = 6, runningCount=0, roundCount=0;
let shoe = [], discard=[]; 
let playerHand=[], dealerCards=[], otherCards=[];
let bankroll = 1000, minBet = 10, betSpread = [[0,1],[1,2],[2,4],[3,8],[4,12]];
let currentBet = 10;
let lastActions = [];

// Hi-Lo values
const hiLo = {2:1,3:1,4:1,5:1,6:1,7:0,8:0,9:0,10:-1,'J':-1,'Q':-1,'K':-1,'A':-1};

// ===================== Charts H17 =====================
const pairChartH17 = {
  'A,A':{'2':'Y','3':'Y','4':'Y','5':'Y','6':'Y','7':'Y','8':'Y','9':'Y','10':'Y','A':'Y'},
  'T,T':{'2':'N','3':'N','4':'N','5':'N','6':'N','7':'N','8':'N','9':'N','10':'N','A':'N'},
  '9,9':{'2':'Y','3':'Y','4':'Y','5':'Y','6':'Y','7':'N','8':'Y','9':'Y','10':'N','A':'N'},
  '8,8':{'2':'Y','3':'Y','4':'Y','5':'Y','6':'Y','7':'Y','8':'Y','9':'Y','10':'Y','A':'Y'},
  '7,7':{'2':'Y','3':'Y','4':'Y','5':'Y','6':'Y','7':'Y','8':'N','9':'N','10':'N','A':'N'},
  '6,6':{'2':'Y/N','3':'Y','4':'Y','5':'Y','6':'Y','7':'N','8':'N','9':'N','10':'N','A':'N'},
  '5,5':{'2':'N','3':'N','4':'N','5':'N','6':'N','7':'N','8':'N','9':'N','10':'N','A':'N'},
  '4,4':{'2':'N','3':'N','4':'N','5':'Y/N','6':'Y/N','7':'N','8':'N','9':'N','10':'N','A':'N'},
  '3,3':{'2':'Y/N','3':'Y/N','4':'Y','5':'Y','6':'Y','7':'Y','8':'N','9':'N','10':'N','A':'N'},
  '2,2':{'2':'Y/N','3':'Y/N','4':'Y','5':'Y','6':'Y','7':'Y','8':'N','9':'N','10':'N','A':'N'}
};

const softChartH17 = {
  'A,9':{'2':'S','3':'S','4':'S','5':'S','6':'S','7':'S','8':'S','9':'S','10':'S','A':'S'},
  'A,8':{'2':'S','3':'S','4':'S','5':'S','6':'Ds','7':'S','8':'S','9':'S','10':'S','A':'S'},
  'A,7':{'2':'Ds','3':'Ds','4':'Ds','5':'Ds','6':'Ds','7':'S','8':'S','9':'H','10':'H','A':'H'},
  'A,6':{'2':'H','3':'D','4':'D','5':'D','6':'D','7':'H','8':'H','9':'H','10':'H','A':'H'},
  'A,5':{'2':'H','3':'H','4':'D','5':'D','6':'D','7':'H','8':'H','9':'H','10':'H','A':'H'},
  'A,4':{'2':'H','3':'H','4':'D','5':'D','6':'D','7':'H','8':'H','9':'H','10':'H','A':'H'},
  'A,3':{'2':'H','3':'H','4':'H','5':'D','6':'D','7':'H','8':'H','9':'H','10':'H','A':'H'},
  'A,2':{'2':'H','3':'H','4':'H','5':'D','6':'D','7':'H','8':'H','9':'H','10':'H','A':'H'}
};

const hardChartH17 = {
  17:{2:'S',3:'S',4:'S',5:'S',6:'S',7:'S',8:'S',9:'S',10:'S','A':'S'},
  16:{2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H','A':'H'},
  15:{2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H','A':'H'},
  14:{2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H','A':'H'},
  13:{2:'S',3:'S',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H','A':'H'},
  12:{2:'H',3:'H',4:'S',5:'S',6:'S',7:'H',8:'H',9:'H',10:'H','A':'H'},
  11:{2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'D','A':'D'},
  10:{2:'D',3:'D',4:'D',5:'D',6:'D',7:'D',8:'D',9:'D',10:'H','A':'H'},
  9:{2:'H',3:'D',4:'D',5:'D',6:'D',7:'H',8:'H',9:'H',10:'H','A':'H'},
  8:{2:'H',3:'H',4:'H',5:'H',6:'H',7:'H',8:'H',9:'H',10:'H','A':'H'}
};

// ========== Helper Functions ==========
function cardValue(card){
  if(['J','Q','K'].includes(card)) return 10;
  if(card==='A') return 11;
  return parseInt(card);
}

function updateCounts(newCard){
  const val = hiLo[newCard];
  if(val!==undefined) runningCount+=val;
  refreshDisplay();
}

function remainingDecks(){return shoe.length/52;}

function trueCount(){return remainingDecks()>0?runningCount/remainingDecks():0;}

// ========================== Deck Functions ==========================
function buildShoe(n){
  shoe=[];
  const cards=['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
  for(let i=0;i<n;i++){
    for(const c of cards) for(let j=0;j<4;j++) shoe.push(c);
  }
  shuffle(shoe); discard=[]; runningCount=0;
}

function shuffle(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];}}

// ========================== UI Functions ==========================
function setDecks(){numDecks=parseInt(document.getElementById('numDecks').value);buildShoe(numDecks);logAction(`Shoe set to ${numDecks} decks`);refreshDisplay();}
function fullReset(){buildShoe(numDecks);playerHand=[];dealerCards=[];otherCards=[];runningCount=0;roundCount=0;currentBet=minBet;logAction('Full reset');refreshDisplay();}
function refreshDisplay(){
  document.getElementById('displayDecks').innerText=numDecks;
  document.getElementById('runningCount').innerText=runningCount;
  document.getElementById('remDecks').innerText=remainingDecks().toFixed(2);
  document.getElementById('trueCount').innerText=trueCount().toFixed(2);
  document.getElementById('playerCards').innerHTML=playerHand.map(c=>`<div class="card">${c}</div>`).join('');
  document.getElementById('dealerCards').innerHTML=dealerCards.map(c=>`<div class="card">${c}</div>`).join('');
  document.getElementById('playerStatus').innerText=`Total: ${handTotal(playerHand)}`;
  document.getElementById('displayBankroll').innerText=bankroll;
  document.getElementById('currentBet').innerText=currentBet;
}

function logAction(msg){const log=document.getElementById('actionLog');log.innerHTML+=`<div>${msg}</div>`;log.scrollTop=log.scrollHeight;}

// ========================== Hand Logic ==========================
function handTotal(hand){let total=0, aces=0;for(const c of hand){if(c==='A'){aces++; total+=11;}else total+=cardValue(c);}while(total>21 && aces>0){total-=10; aces--;} return total;}
function isSoft(hand){return hand.includes('A') && handTotal(hand)<=21 && handTotal(hand)-11<10;}

function getRecommendedMove(){
  if(playerHand.length===2){
    const pair = playerHand[0]+','+playerHand[1];
    if(pairChartH17[pair]){
      const move = pairChartH17[pair][dealerCards[0]] || '-';
      return move;
    }
  }
  if(isSoft(playerHand)){
    const key='A,'+(playerHand.find(c=>c!=='A'));
    const move = softChartH17[key][dealerCards[0]] || '-';
    return move;
  }
  const total=handTotal(playerHand);
  const move=hardChartH17[total]?[hardChartH17[total][dealerCards[0]]||'-']:'-';
  return move;
}

// ========================== Button Actions ==========================
function processInput(){
  const text=document.getElementById('setup').value.trim().toUpperCase();
  // Example: "N6 D10 M10 P7"
  let parts=text.split(/\s+/);
  for(const p of parts){
    if(p.startsWith('D')) dealerCards=[p.slice(1)];
    else if(p.startsWith('P') || p.startsWith('M')) playerHand.push(p.slice(1));
    else if(p.startsWith('N')){numDecks=parseInt(p.slice(1));buildShoe(numDecks);}
  }
  roundCount++; refreshDisplay();
  const rec=getRecommendedMove();
  document.getElementById('recommendedMove').innerText=rec;
}

function nextRound(){playerHand=[];dealerCards=[];otherCards=[];document.getElementById('recommendedMove').innerText='-';document.getElementById('winPercent').innerText='-';roundCount++;refreshDisplay();}

function addCard(){const c=document.getElementById('addCard').value.trim().toUpperCase();if(c){playerHand.push(c);updateCounts(c);document.getElementById('addCard').value='';refreshDisplay();document.getElementById('recommendedMove').innerText=getRecommendedMove();}}

function undoLast(){if(playerHand.length>0){const c=playerHand.pop();logAction(`Removed ${c}`);refreshDisplay();document.getElementById('recommendedMove').innerText=getRecommendedMove();}}

function addOtherPlayers(){const c=document.getElementById('otherPlayers').value.trim().toUpperCase().split(',');for(const x of c){otherCards.push(x.trim());updateCounts(x.trim());}document.getElementById('otherPlayers').value='';refreshDisplay();}

function setDealerHole(){const c=document.getElementById('dealerDraws').value.trim().toUpperCase().split(',');dealerCards=c.map(x=>x.trim());for(const card of dealerCards) updateCounts(card);refreshDisplay();}

function burnCard(){const c=shoe.pop();discard.push(c);updateCounts(c);logAction(`Burned ${c}`);refreshDisplay();}

function doSplit(){logAction('Split hand');/*TODO: manage multiple hands*/refreshDisplay();}
function doDouble(){logAction('Double bet');currentBet*=2;refreshDisplay();}
function finishHand(){logAction('Hand finished');playerHand=[];dealerCards=[];refreshDisplay();}

function applySpread(){const t=document.getElementById('spreadMap').value.trim().split(',');betSpread=[];for(const e of t){const [tc,bet]=e.split(':').map(x=>parseInt(x));betSpread.push([tc,bet]);}logAction('Applied bet spread');refreshDisplay();}
function placeSuggestedBet(){const tc=Math.floor(trueCount());let found=betSpread.find(b=>b[0]<=tc);currentBet=(found?found[1]*minBet:minBet);logAction(`Suggested bet $${currentBet}`);refreshDisplay();}

function recordWin(){bankroll+=currentBet;logAction(`Win $${currentBet}`);nextRound();}
function recordLoss(){bankroll-=currentBet;logAction(`Loss $${currentBet}`);nextRound();}
function recordPush(){logAction(`Push $${currentBet}`);nextRound();}

function saveSettings(){localStorage.setItem('bjBankroll',bankroll);localStorage.setItem('bjDecks',numDecks);localStorage.setItem('bjMinBet',minBet);logAction('Settings saved');}
function loadSettings(){bankroll=parseInt(localStorage.getItem('bjBankroll'))||bankroll;numDecks=parseInt(localStorage.getItem('bjDecks'))||numDecks;minBet=parseInt(localStorage.getItem('bjMinBet'))||minBet;buildShoe(numDecks);refreshDisplay();logAction('Settings loaded');}
</script>

</body>
</html>
