<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Blackjack Hi-Lo & Strategy Analyzer</title>
<style>
  body {
    background: #0f0f0f;
    color: #f1f1f1;
    font-family: "Inter", sans-serif;
    margin: 0;
    padding: 2rem;
  }
  h1 { color: #00ffa0; margin-bottom: 0.5rem; }
  input {
    background: #222;
    color: #fff;
    border: 1px solid #555;
    padding: 0.6rem 1rem;
    font-size: 1rem;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
  }
  button {
    background: #00ffa0;
    color: #000;
    border: none;
    padding: 0.6rem 1rem;
    font-weight: bold;
    margin-left: 0.5rem;
    border-radius: 8px;
    cursor: pointer;
  }
  .output { margin-top: 1.5rem; background: #1a1a1a; padding: 1rem; border-radius: 12px; max-width: 700px; }
  .section { margin-top: 1.5rem; }
  .stat { margin: 0.4rem 0; }
  .highlight { color: #00ffa0; font-weight: bold; }
  .warning { color: #ff5555; font-weight: bold; }
  .live-indicator { display:inline-block; width:10px; height:10px; background:red; border-radius:50%; margin-right:0.5rem; animation: pulse 1s infinite; vertical-align:middle;}
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }
  .deck { margin-top: 1rem; display:flex; flex-wrap:wrap; gap:4px; }
  .card { padding:4px 6px; background:#222; border-radius:4px; font-size:0.9rem; }
</style>
</head>
<body>

<h1>üÉè Blackjack Analyzer <span class="live-indicator"></span>LIVE</h1>

<div>
  <input id="setup" placeholder="Enter initial shorthand (e.g. N6 D10 M9 P7)" />
  <button onclick="processInput()">Analyze</button>
</div>

<div class="section">
  <p>Add your next card (Hit, Double, Split) <code>P3</code></p>
  <input id="addCard" placeholder="Enter next card..." />
  <button onclick="addCard()">Add Card</button>
</div>

<div class="section">
  <p>Add <b>Other Player's card</b> <code>O10</code></p>
  <input id="otherCard" placeholder="Enter other player's card..." />
  <button onclick="addOtherCard()">Add Other Player Card</button>
</div>

<div class="section">
  <p>Add <b>Dealer hit card</b> <code>H5</code></p>
  <input id="dealerHit" placeholder="Enter dealer hit card..." />
  <button onclick="addDealerHit()">Add Dealer Hit Card</button>
</div>

<div class="section">
  <p>Burn card (removed before play)</p>
  <input id="burnCard" placeholder="Enter burn card..." />
  <button onclick="burnCard()">Burn Card</button>
</div>

<div class="section">
  <p>Round Results</p>
  <button onclick="recordWin()">Record Win ‚úÖ</button>
  <button onclick="recordLoss()">Record Loss ‚ùå</button>
</div>

<div class="output" id="output"></div>
<div class="deck" id="deckDisplay"></div>

<script>
  // ====== STATE ======
  let numDecks = 6;
  let runningCount = 0;
  let seenCards = [];
  let dealerCard = null;
  let playerCards = [];
  let otherCards = [];
  let dealerHits = [];
  let burnedCards = [];
  let deck = [];
  let rounds = 0, wins = 0, losses = 0;

  const hiLoValues = { 2:1, 3:1, 4:1, 5:1, 6:1, 7:0, 8:0, 9:0, 10:-1, J:-1, Q:-1, K:-1, A:-1 };

  // ====== UTILS ======
  function cardValue(card){
    if(['J','Q','K'].includes(card)) return 10;
    if(card==='A') return 11;
    return parseInt(card);
  }

  function parseInput(str){
    const parts = str.trim().toUpperCase().split(/\s+/);
    for(let p of parts){
      if(p.startsWith("N")){ numDecks=parseInt(p.slice(1))||1; resetState(); continue; }
      if(p.startsWith("D")) dealerCard=p.slice(1);
      else if(p.startsWith("M")||p.startsWith("P")) playerCards.push(p.slice(1));
    }
  }

  function resetState(){
    runningCount=0;
    seenCards=[];
    dealerCard=null;
    playerCards=[];
    otherCards=[];
    dealerHits=[];
    burnedCards=[];
    buildDeck();
  }

  function buildDeck(){
    const suits=['H','D','C','S'];
    const ranks=['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    deck=[];
    for(let d=0; d<numDecks; d++){
      for(let r of ranks){
        for(let s of suits){
          deck.push(r);
        }
      }
    }
  }

  function updateCount(card){
    if(hiLoValues.hasOwnProperty(card)) runningCount += hiLoValues[card];
    seenCards.push(card);
    const index = deck.indexOf(card);
    if(index>-1) deck.splice(index,1);
  }

  function calcTrueCount(){
    const totalCards=numDecks*52;
    const remainingDecks=Math.max(deck.length/52, 1);
    return (runningCount/remainingDecks).toFixed(2);
  }

  function calcDecksRemaining(){
    return (deck.length/52).toFixed(2);
  }

  function handTotal(cards){
    let total=0, aces=0;
    for(let c of cards){
      if(c==='A') aces++; else total+=cardValue(c);
    }
    for(let i=0;i<aces;i++){ total += (total+11<=21)?11:1; }
    return total;
  }

  function basicStrategy(playerTotal,dealerUp,isSoft){
    if(isSoft){
      if(playerTotal>=19) return "Stand";
      if(playerTotal===18 && [2,7,8].includes(dealerUp)) return "Stand";
      if(playerTotal===18 && [3,4,5,6].includes(dealerUp)) return "Double (if allowed) else Stand";
      if(playerTotal<=17 && [5,6].includes(dealerUp)) return "Double (if allowed) else Hit";
      return "Hit";
    }else{
      if(playerTotal>=17) return "Stand";
      if(playerTotal>=13 && dealerUp<=6) return "Stand";
      if(playerTotal===12 && [4,5,6].includes(dealerUp)) return "Stand";
      if(playerTotal===11 || playerTotal===10) return "Double (if allowed)";
      return "Hit";
    }
  }

  function updateDeckDisplay(){
    const deckDiv=document.getElementById("deckDisplay");
    deckDiv.innerHTML = deck.map(c=>`<span class="card">${c}</span>`).join("");
  }

  function updateDisplay(){
    const playerTotal = handTotal(playerCards);
    const isSoft = playerCards.includes('A') && playerTotal<=21 && playerTotal-11<10;
    const dealerVal = dealerCard ? cardValue(dealerCard) : 0;
    const trueCount = calcTrueCount();
    const decksRemaining = calcDecksRemaining();
    const strategy = dealerCard ? basicStrategy(playerTotal,dealerVal,isSoft) : "-";

    let betAdvice="Minimum Bet";
    if(trueCount>=2) betAdvice="Increase Bet (Edge!)";
    else if(trueCount<=-1) betAdvice="Reduce Bet";

    document.getElementById("output").innerHTML=`
      <div class="stat">Decks: <span class="highlight">${numDecks}</span></div>
      <div class="stat">Decks Remaining: <span class="highlight">${decksRemaining}</span></div>
      <div class="stat">Dealer: <span class="highlight">${dealerCard||"-"}</span></div>
      <div class="stat">Player: <span class="highlight">${playerCards.join(", ")||"-"}</span> (Total = ${playerTotal})</div>
      <div class="stat">Other Players: <span class="highlight">${otherCards.join(", ")||"-"}</span></div>
      <div class="stat">Dealer Hits: <span class="highlight">${dealerHits.join(", ")||"-"}</span></div>
      <div class="stat">Burned: <span class="highlight">${burnedCards.join(", ")||"-"}</span></div>
      <hr>
      <div class="stat">Running Count: <span class="highlight">${runningCount}</span></div>
      <div class="stat">True Count: <span class="highlight">${trueCount}</span></div>
      <div class="stat">Recommended Move: <span class="highlight">${strategy}</span></div>
      <div class="stat">Bet Suggestion: <span class="${trueCount>=2?'highlight':(trueCount<=-1?'warning':'')}">${betAdvice}</span></div>
      <hr>
      <div class="stat">Rounds Played: <span class="highlight">${rounds}</span></div>
      <div class="stat">Wins: <span class="highlight">${wins}</span> | Losses: <span class="warning">${losses}</span></div>
    `;
    updateDeckDisplay();
  }

  // ====== INPUT HANDLERS ======
  function processInput(){
    resetState();
    parseInput(document.getElementById("setup").value);
    const allCards=[dealerCard,...playerCards].filter(Boolean);
    for(let c of allCards) updateCount(c);
    updateDisplay();
  }

  function addCard(){
    const input=document.getElementById("addCard").value.trim().toUpperCase();
    if(!input) return;
    const card=input.startsWith("P")?input.slice(1):input;
    playerCards.push(card);
    updateCount(card);
    document.getElementById("addCard").value="";
    updateDisplay();
  }

  function addOtherCard(){
    const input=document.getElementById("otherCard").value.trim().toUpperCase();
    if(!input) return;
    const card=input.startsWith("O")?input.slice(1):input;
    otherCards.push(card);
    updateCount(card);
    document.getElementById("otherCard").value="";
    updateDisplay();
  }

  function addDealerHit(){
    const input=document.getElementById("dealerHit").value.trim().toUpperCase();
    if(!input) return;
    const card=input.startsWith("H")?input.slice(1):input;
    dealerHits.push(card);
    updateCount(card);
    document.getElementById("dealerHit").value="";
    updateDisplay();
  }

  function burnCard(){
    const input=document.getElementById("burnCard").value.trim().toUpperCase();
    if(!input) return;
    burnedCards.push(input);
    updateCount(input);
    document.getElementById("burnCard").value="";
    updateDisplay();
  }

  function recordWin(){ rounds++; wins++; updateDisplay(); }
  function recordLoss(){ rounds++; losses++; updateDisplay(); }

</script>
</body>
</html>
