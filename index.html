<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blackjack Hi-Lo & Strategy Analyzer</title>
  <style>
    body {
      background: #0f0f0f;
      color: #f1f1f1;
      font-family: "Inter", sans-serif;
      margin: 0;
      padding: 2rem;
    }
    h1 { color: #00ffa0; margin-bottom: 0.5rem; }
    input {
      background: #222;
      color: #fff;
      border: 1px solid #555;
      padding: 0.6rem 1rem;
      font-size: 1rem;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
    }
    button {
      background: #00ffa0;
      color: #000;
      border: none;
      padding: 0.6rem 1rem;
      font-weight: bold;
      margin-left: 0.5rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .output {
      margin-top: 1.5rem;
      background: #1a1a1a;
      padding: 1rem;
      border-radius: 12px;
      max-width: 600px;
    }
    .stat { margin: 0.4rem 0; }
    .highlight { color: #00ffa0; font-weight: bold; }
    .warning { color: #ff5555; font-weight: bold; }
  </style>
</head>
<body>
  <h1>üÉè Blackjack Analyzer</h1>
  <p>Type shorthand like <code>N6 D10 M9 P7</code> (6 decks, dealer 10, your cards 9 and 7)</p>

  <input id="cmd" placeholder="Enter shorthand..." />
  <button onclick="processInput()">Analyze</button>

  <div class="output" id="output"></div>

  <script>
    // ====== STATE ======
    let numDecks = 6;
    let runningCount = 0;
    let seenCards = [];
    let dealerCard = null;
    let playerCards = [];

    const hiLoValues = {
      2: 1, 3: 1, 4: 1, 5: 1, 6: 1,
      7: 0, 8: 0, 9: 0,
      10: -1, J: -1, Q: -1, K: -1, A: -1
    };

    // ====== UTILS ======
    function cardValue(card) {
      if (['J', 'Q', 'K'].includes(card)) return 10;
      if (card === 'A') return 11;
      return parseInt(card);
    }

    function parseInput(str) {
      const parts = str.trim().toUpperCase().split(/\s+/);
      for (let p of parts) {
        if (p.startsWith("N")) { numDecks = parseInt(p.slice(1)) || 1; resetState(); continue; }
        if (p.startsWith("D")) dealerCard = p.slice(1);
        else if (p.startsWith("M") || p.startsWith("P")) playerCards.push(p.slice(1));
      }
    }

    function resetState() {
      runningCount = 0;
      seenCards = [];
      dealerCard = null;
      playerCards = [];
    }

    function updateCount(card) {
      if (hiLoValues.hasOwnProperty(card)) runningCount += hiLoValues[card];
      seenCards.push(card);
    }

    function calcTrueCount() {
      const totalCards = numDecks * 52;
      const remainingDecks = Math.max((totalCards - seenCards.length) / 52, 1);
      return (runningCount / remainingDecks).toFixed(2);
    }

    function handTotal(cards) {
      let total = 0, aces = 0;
      for (let c of cards) {
        if (c === 'A') aces++;
        else total += cardValue(c);
      }
      for (let i = 0; i < aces; i++) {
        total += (total + 11 <= 21) ? 11 : 1;
      }
      return total;
    }

    // ====== BASIC STRATEGY (simplified core) ======
    function basicStrategy(playerTotal, dealerUp, isSoft) {
      if (isSoft) {
        if (playerTotal >= 19) return "Stand";
        if (playerTotal === 18 && [2, 7, 8].includes(dealerUp)) return "Stand";
        if (playerTotal === 18 && [3, 4, 5, 6].includes(dealerUp)) return "Double (if allowed) else Stand";
        if (playerTotal <= 17 && [5,6].includes(dealerUp)) return "Double (if allowed) else Hit";
        return "Hit";
      } else {
        if (playerTotal >= 17) return "Stand";
        if (playerTotal >= 13 && dealerUp <= 6) return "Stand";
        if (playerTotal === 12 && [4, 5, 6].includes(dealerUp)) return "Stand";
        if (playerTotal === 11 || playerTotal === 10) return "Double (if allowed)";
        return "Hit";
      }
    }

    // ====== MAIN PROCESS ======
    function processInput() {
      resetState();
      const input = document.getElementById("cmd").value;
      parseInput(input);

      // update count
      const allCards = [dealerCard, ...playerCards].filter(Boolean);
      for (let c of allCards) updateCount(c);

      const playerTotal = handTotal(playerCards);
      const isSoft = playerCards.includes('A') && playerTotal <= 21 && playerTotal - 11 < 10;
      const dealerVal = cardValue(dealerCard);
      const trueCount = calcTrueCount();
      const strategy = basicStrategy(playerTotal, dealerVal, isSoft);

      // Bet suggestion
      let betAdvice = "Minimum Bet";
      if (trueCount >= 2) betAdvice = "Increase Bet (Edge!)";
      else if (trueCount <= -1) betAdvice = "Reduce Bet";

      document.getElementById("output").innerHTML = `
        <div class="stat">Decks: <span class="highlight">${numDecks}</span></div>
        <div class="stat">Dealer: <span class="highlight">${dealerCard || "-"}</span></div>
        <div class="stat">Player: <span class="highlight">${playerCards.join(", ") || "-"}</span> (Total = ${playerTotal})</div>
        <hr>
        <div class="stat">Running Count: <span class="highlight">${runningCount}</span></div>
        <div class="stat">True Count: <span class="highlight">${trueCount}</span></div>
        <div class="stat">Recommended Move: <span class="highlight">${strategy}</span></div>
        <div class="stat">Bet Suggestion: <span class="${trueCount >= 2 ? 'highlight' : (trueCount <= -1 ? 'warning' : '')}">${betAdvice}</span></div>
      `;
    }
  </script>
</body>
</html>
